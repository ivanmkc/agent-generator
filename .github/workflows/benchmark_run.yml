name: Run Benchmarks

on:
  workflow_dispatch:
  schedule:
    # Run weekly on Sunday at midnight
    - cron: '0 0 * * 0'

jobs:
  run-benchmarks:
    runs-on: ubuntu-latest
    permissions:
      contents: 'read'
      id-token: 'write'

    env:
      BENCHMARK_GCS_BUCKET: ${{ vars.BENCHMARK_GCS_BUCKET }}
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: "3.12"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    - name: Authenticate to Google Cloud
      uses: google-github-actions/auth@v2
      with:
        credentials_json: ${{ secrets.GCP_CREDENTIALS }}

    - name: Run Benchmarks and Upload
      run: |
        chmod +x notebooks/run_benchmarks.sh
        ./notebooks/run_benchmarks.sh --model-filter gemini-2.5-flash
